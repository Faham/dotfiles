#!/bin/bash

pntDevId=$( xinput list | grep "pointer" | grep -v "Virtual" | grep -o "id=[0-9]*" | cut -d= -f2 )

# disable all pointing devices
for f in $pntDevId
do
   xinput set-prop $f "Device Enabled" "0"
done

# if "off" is given as parameter, then spawn a new thread to turn off the screen
[ "$1" = "off" ] && $(sleep 1 &&  xset dpms force off) &

# Save current keyboard layout, variant, and options
CURRENT_LAYOUT=$(setxkbmap -query | grep layout | awk '{print $2}')
CURRENT_VARIANT=$(setxkbmap -query | grep variant | awk '{print $2}' || echo "")
CURRENT_OPTIONS=$(setxkbmap -query | grep options | awk '{print $2}' || echo "")

# Set to US English layout (no variant, no options)
setxkbmap -layout us -variant "" -option ""

betterlockscreen -l blur

# Restore original keyboard layout, variant, and options
setxkbmap -layout "$CURRENT_LAYOUT" -variant "$CURRENT_VARIANT" -option "$CURRENT_OPTIONS"

# enable all pointing devices
for f in $pntDevId
do
   xinput set-prop $f "Device Enabled" "1"
done
