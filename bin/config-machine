#!/bin/bash

set -e
set -o pipefail

USER=fahamne

sudo usermod -G disk --append $USER

[ -f /etc/gdm/custom.conf ] && sudo sed  -i "s/^#WaylandEnable=false/WaylandEnable=false/" /etc/gdm/custom.conf
sudo patch -r - /etc/sudoers files/sudoers.patch
sudo patch -r - /etc/pacman.conf files/pacman.conf.patch
sudo cp files/motd /etc/motd

PACKAGES="
bashrun            p7zip                   vlc
cmake              pcmanfm                 wget
conky              pm-utils                xclip
ctags              pulseaudio              xdot
cups               python-pip              xdotool
downgrade          python2                 xf86-input-synaptics
evince             python2-pip             xf86-video-intel
exfat-utils        qalculate-gtk           xloadimage
festival-us        remmina                 xorg-apps
fluxbox            samba                   xorg-server
freerdp            scrot                   xorg-server-utils
ghostscript        sshfs                   xorg-xinit
gimp               terminator              xorg-xmessage
git                tk                      xosd
goldendict         tmux                    xscreensaver
gparted            ttf-bitstream-vera      xterm
gpicview           ttf-dejavu              yaourt
gsfonts            ttf-freefont            youtube-dl
gvfs               ttf-inconsolata         zip
htop               ttf-liberation          zsh
imagemagick        ttf-linux-libertine     rsync
libimobiledevice   ttf-ubuntu-font-family  gvfs-mtp
libva-intel-driver unclutter               xbindkeys
libvdpau-va-gl     unzip                   mutagen 
linux-headers      vim                     sudo
mesa-libgl         vim-spell-en            patch
nmap               virtualbox              fakeroot
ntfs-3g            virtualbox-guest-utils  cmus
openssh            virtualbox-host-dkms
"

sudo pacman -Syy
sudo pacman -S $PACKAGES --noconfirm

sudo systemctl enable sshd.service
sudo systemctl start sshd.service

sudo ~/bin/set-python 2.7
sudo pip install twisted argparse
sudo ~/bin/set-python 3.5

sudo ln -s /etc/fonts/conf.avail/70-no-bitmaps.conf /etc/fonts/conf.d

# required groups membership for cups administration at http://http://127.0.0.1:631/
sudo gpasswd -a fahamne lp
sudo gpasswd -a fahamne sys

yaourt -S google-chrome sublime-text-dev viber

git submodule update --init --recursive
cd ~/.vim/bundle/YouCompleteMe && ./install.py

[ -f /usr/bin/subl ] || sudo ln -s /usr/bin/subl3 /usr/bin/subl
[ -f /etc/ssh/sshd_config ] && sudo patch -r - /etc/ssh/sshd_config files/sshd_config.patch
