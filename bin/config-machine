#!/bin/bash

USER=faham

function _add_line_if_not_exists { 
    grep -qx -F "$2" $1 || echo "$2" >> $1
}

sudo [ -f /etc/gdm/custom.conf ] && sed  -i "s/^#WaylandEnable=false/WaylandEnable=false/" /etc/gdm/custom.conf

sudo sed  -i "s/^# %sudo   ALL=(ALL) ALL$/%sudo   ALL=(ALL) ALL/" /etc/sudoers
sudo sed  -i "s/^\(# Defaults targetpw\)\(.*\)$/Defaults targetpw\2/" /etc/sudoers
sudo _add_line_if_not_exists /etc/sudoers \
    "%users ALL=(ALL) NOPASSWD:/usr/bin/pm-suspend, /usr/bin/pm-hibernate, /usr/bin/poweroff, /usr/bin/reboot"

sudo sed  -i "s/^#\[multilib\]$/[multilib]/" /etc/pacman.conf
sudo [ -f /etc/pacman.conf ] && grep -qx -F "[archlinuxfr]" /etc/pacman.conf || echo "
[archlinuxfr]
SigLevel    = Never
Server = http://repo.archlinux.fr/x86_64
" >> /etc/pacman.conf

sudo pacman -Syy

sudo pacman -S fluxbox xosd terminator zsh pcmanfm vlc \
unclutter conky xscreensaver goldendict yaourt xdotool xterm bashrun git vim \
xorg-server xorg-apps xorg-server-utils xf86-video-intel xf86-input-synaptics \
mesa-libgl xorg-xinit ttf-dejavu htop openssh wget pulseaudio cmake python2 \
evince ctags gpicview zip unzip tk gvfs linux-headers virtualbox-guest-utils exfat-utils

yaourt -S google-chrome sublime-text-dev viber acroread

git submodule update --init --recursive
cd ~/.vim/bundle/YouCompleteMe && ./install.py

sudo [ -f /etc/ssh/sshd_config ] && grep -qx -F "AllowUsers .*" /etc/ssh/sshd_config || echo "
AllowUsers $USER
" >> /etc/ssh/sshd_config

sudo rm /bin/python
sudo ln -s /bin/python2 /bin/python
sudo ln -s /usr/bin/subl3 /usr/bin/subl

